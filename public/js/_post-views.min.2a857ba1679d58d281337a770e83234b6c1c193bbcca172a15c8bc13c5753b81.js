(()=>{(function(){"use strict";function e(){const e=document.querySelector(".post-view-count .view-count-number");if(!e)return;const n=document.querySelector(".post-view-count")?.dataset.pageUrl;if(!n)return;const s=window.siteConfig?.umamiUseForPostViews&&window.siteConfig?.umamiApiUrl;s?o(n,e):t(n,e)}function t(e,t){const o=`post_view_${e}`;let s=parseInt(localStorage.getItem(o)||"0",10);const i=`post_view_session_${e}`,a=sessionStorage.getItem(i);a||(s+=1,localStorage.setItem(o,s.toString()),sessionStorage.setItem(i,"true")),n(t,s)}async function o(e,s){const o=`post_view_${e}`,a=`post_view_session_${e}`,i=parseInt(localStorage.getItem(o)||"0",10);i>0&&n(s,i);try{const l=window.siteConfig.umamiApiUrl;if(!l)throw new Error("API URL 未配置");const d=window.location.origin+e,u=l.replace(/\/$/,"");let h=`${u}/pageviews?url=${encodeURIComponent(d)}`;const c=await fetch(h);if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const i=await c.json();let r=0;if(typeof i=="number")r=i;else if(i&&typeof i.views=="number")r=i.views;else if(i&&typeof i.pageviews=="number")r=i.pageviews;else if(i&&typeof i.count=="number")r=i.count;else if(Array.isArray(i)&&i.length>0){const e=i[0];r=e.views||e.count||e.pageviews||0}r>0?(n(s,r),localStorage.setItem(o,r.toString()),sessionStorage.setItem(a,"true")):t(e,s)}catch{t(e,s)}}function n(e,t){if(!e)return;const a=s(t),n=e.textContent.replace(/[^\d]/g,""),o=n?parseInt(n,10):0;o!==t?i(e,o||0,t,500):e.textContent=a}function i(e,t,n,o){const a=performance.now(),r=n-t;function i(c){const d=c-a,l=Math.min(d/o,1),u=1-(1-l)**3,h=Math.floor(t+r*u);e.textContent=s(h),l<1?requestAnimationFrame(i):e.textContent=s(n)}requestAnimationFrame(i)}function s(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e(),document.addEventListener("pjax:complete",e),window.initPostViews=e})()})()