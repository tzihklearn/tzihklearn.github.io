(()=>{(function(){"use strict";if(window.siteConfig?.pjaxEnabled!=="true")return;let e=!1;const n="pjax-loading";function a(){const e=document.createElement("div");e.id="simple-pjax-loader",e.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #4fc3f7, #29b6f6, #03a9f4);
      z-index: 9999;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    `,document.body.appendChild(e)}function r(){if(e)return;e=!0;const t=document.getElementById("simple-pjax-loader");t&&(t.style.transform="translateX(0)"),document.body.classList.add(n)}function c(){e=!1;const t=document.getElementById("simple-pjax-loader");t&&(t.style.transform="translateX(-100%)"),setTimeout(()=>{document.body.classList.remove(n)},100)}function l(e){if(e.target==="_blank")return!1;if(e.download)return!1;if(e.classList.contains("no-pjax"))return!1;if(e.href.includes("#"))return!1;try{const t=new URL(e.href);return t.origin===window.location.origin}catch{return!1}}async function s(t){if(e)return;r();const n=new AbortController,s=setTimeout(()=>n.abort(),1e4);try{const e=await fetch(t,{signal:n.signal,headers:{"X-Requested-With":"XMLHttpRequest"}});if(clearTimeout(s),!e.ok)throw new Error(`HTTP ${e.status}`);const l=await e.text(),d=new DOMParser,o=d.parseFromString(l,"text/html");document.title=o.title;const i=document.querySelector(".site-main"),a=o.querySelector(".site-main");i&&a&&(i.innerHTML=a.innerHTML);const r=document.querySelector(".site-aside-right"),c=o.querySelector(".site-aside-right");r&&c&&(r.innerHTML=c.innerHTML),history.pushState({pjax:!0},"",t),window.scrollTo({top:0,behavior:"instant"}),u(),document.dispatchEvent(new CustomEvent("pjax:complete",{detail:{url:t}}))}catch{window.location.href=t}finally{c()}}function d(){document.addEventListener("click",function(e){const t=e.target.closest("a");if(!t)return;l(t)&&(e.preventDefault(),s(t.href))}),window.addEventListener("popstate",function(e){e.state&&e.state.pjax&&s(window.location.href)})}let t=null;function o(e=0,n=10){const s=document.getElementById("artalk-comment");if(!s)return;if(e===0&&(s.innerHTML='<p style="text-align: center; color: #666; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> 正在加载评论系统...</p>'),typeof Artalk=="undefined"){e<n?setTimeout(()=>{o(e+1,n)},100):s.innerHTML='<p style="color: #f44336; text-align: center; padding: 20px;"><i class="fas fa-exclamation-triangle"></i> 评论系统加载超时，请刷新页面重试</p>';return}try{if(t){try{t.destroy()}catch{}t=null}s.innerHTML="";const e=document.documentElement.getAttribute("data-theme"),n=e==="dark";t=Artalk.init({el:"#artalk-comment",pageKey:window.location.pathname,pageTitle:document.title,server:window.siteConfig?.artalkServer||"https://site.demius.tech",site:window.siteConfig?.artalkSite||"demius",placeholder:"说点什么吧~",darkMode:n,locale:"zh-CN",gravatar:{params:"mp"},pagination:{pageSize:10},emoticons:!0,heightLimit:500})}catch(e){console.error("PJAX: 评论系统初始化失败:",e),s&&(s.innerHTML='<p style="color: #666; text-align: center; padding: 20px;">评论系统暂时不可用，请稍后再试</p>')}}function u(){const e=window.location.pathname,t=e==="/"||e==="/index.html"||e.startsWith("/page/"),n=e.startsWith("/posts/");if(document.body.classList.remove("home","single-post"),t?document.body.classList.add("home"):n&&document.body.classList.add("single-post"),setTimeout(()=>{o()},200),window.initCodeBlocks&&window.initCodeBlocks(),window.initImageViewer&&window.initImageViewer(),window.initToc&&window.initToc(),window.initSearch&&window.initSearch(),window.initComments&&window.initComments(),window.initEncryption&&window.initEncryption(),window.cleanupGallery&&window.cleanupGallery(),window.initGallery&&window.initGallery(),window.cleanupStickyHeader&&window.cleanupStickyHeader(),window.initStickyHeader&&window.initStickyHeader(),window.cleanupCarousel&&window.cleanupCarousel(),window.initCarousel&&window.initCarousel(),window.initSeriesPostsCarousel&&window.initSeriesPostsCarousel(),window.initReward&&window.initReward(),window.cleanupTabs&&window.cleanupTabs(),window.initTabs&&window.initTabs(),window.cleanupCollapse&&window.cleanupCollapse(),window.initCollapse&&window.initCollapse(),window.cleanupTimeline&&window.cleanupTimeline(),window.initTimeline&&window.initTimeline(),window.cleanupMusicPlayers&&window.cleanupMusicPlayers(),window.initMusicPlayers&&window.initMusicPlayers(),window.cleanupReplyVisible&&window.cleanupReplyVisible(),window.initReplyVisible&&window.initReplyVisible(),window.cleanupRunningTime&&window.cleanupRunningTime(),window.initRunningTime&&window.initRunningTime(),window.initPinnedStyle&&window.initPinnedStyle(),window.setAsideWidth&&window.setAsideWidth(),window.setFontFamily&&window.setFontFamily(),window.renderTalks&&window.renderTalks(),window.initTopAnnouncement&&window.initTopAnnouncement(),window.cleanupMobile&&window.cleanupMobile(),window.cleanupHeaderScrollBehavior&&window.cleanupHeaderScrollBehavior(),window.cleanupMobileToc&&window.cleanupMobileToc(),window.initMobileNavigation&&window.initMobileNavigation(),window.initHeaderScrollBehavior&&window.initHeaderScrollBehavior(),window.initMobileToc){let e=function(){t++;const s=document.querySelector(".site-aside-right"),o=s&&s.querySelector(".aside-card, .toc-content, .toc-widget, .aside-title");o||t>=n?window.initMobileToc():setTimeout(e,100)},t=0;const n=5;setTimeout(e,150)}if(window.initDataPage&&window.initDataPage(),window.initFriendsCircle&&setTimeout(()=>{document.querySelector(".friends-circle-page")&&window.initFriendsCircle()},150),window.initDanmaku&&window.initDanmaku(),t){const e=window.location.pathname==="/"||window.location.pathname==="/index.html";e&&(sessionStorage.setItem("pjaxToHomePage","true"),sessionStorage.removeItem("homeBigImageSwitched")),window.cleanupTypewriter&&window.cleanupTypewriter(),typeof initHomeBigImage=="function"&&initHomeBigImage(),e&&window.initTypewriter&&window.initTypewriter(),setTimeout(()=>{sessionStorage.removeItem("pjaxToHomePage")},100)}}function i(){a(),d()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()})()})()